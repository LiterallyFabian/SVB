<html class="theme_light">

<head>
    <!--Scripts-->
    <script src="https://kit.fontawesome.com/2db49cb13f.js" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/jquery@3.5.1/dist/jquery.js"></script>
    <script src="https://unpkg.com/vue@3.0.5"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400&display=swap" rel="stylesheet">
    <script src="/js/svt.js"></script>
    <!--Styling-->
    <link href="/stylesheets/main.css" rel="stylesheet" type="text/css">
    <!--Meta-->
    <title>SVT</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body id="profilebody">

    <!--Navigation bar-->
    <div id="nav-placeholder"></div>

    <script>
        $(function () {
            $("#nav-placeholder").load("/reused/nav.html");
        });
    </script>
    <!--end of Navigation bar-->

    <div id="page" class="profile">
        <div id="banner" class="hero-image">
            <div class="banneritems">
                <div class="hero-text">
                    <img class="avatar" :src="avatar" alt="profile picture"></img>
                    <h1>{{ username }}</h1>
                    <div id="badges">

                    </div>
                    <div v-if="id == myID" style="padding:2%;">
                        <a v-bind:href="editref"><i class="editprofile far fa-edit fa-sm">
                            </i></a></div>
                    <p class="bio">{{ bio }}</p>
                </div>
            </div>
        </div>
        <!-- Game scores -->
        <div id="profilegallery" class="center">
            <div class="center game-stats">
                <!-- SajberRoyale scores -->
                <div>
                    <h1 style="padding:20px; margin:0; text-decoration: underline;">SajberRoyale stats</h1>
                    <p>Games played: {{royale_games}}</p>
                    <p>Games won: {{royale_wins}} ({{royale_winrate}}%)</p>
                    <p>Eliminations: {{royale_kills}}</p>
                    <p>Deaths: {{royale_deaths}}</p>
                    <p>KD: {{royale_kd}}</p>
                    <p>Damage done: {{royale_damageDone}}</p>
                    <p>Damage taken: {{royale_damageTaken}}</p>
                    <p>Health regenerated: {{royale_health}}</p>
                    <p>Shots fired: {{royale_shotsFired}}</p>
                    <p>Shots hit: {{royale_shotsHit}} ({{royale_acc}}%)</p>
                    <p>Emotes emoted: {{royale_emotes}}</p>
                    <p>Items picked up: {{royale_items}}</p>
                    <p>Lockers opened: {{royale_lockers}}</p>
                </div>
                <hr>
                <!-- Catch scores -->
                <div>
                    <h1 style="padding:20px; margin:0; text-decoration: underline;">svt!catch stats</h1>
                    <ul id="rank-list">
                        <h2>Ranks achieved</h2>
                        <li>
                            <img src="/img/ranking-SS.png" alt="SS Icon" />
                            <h3>{{ catch_ranks_SS }}</h3>
                        </li>
                        <li>
                            <img src="/img/ranking-S.png" alt="S Icon" />
                            <h3>{{ catch_ranks_S }}</h3>
                        </li>
                        <li>
                            <img src="/img/ranking-A.png" alt="A Icon" />
                            <h3>{{ catch_ranks_A }}</h3>
                        </li>
                        <li>
                            <img src="/img/ranking-B.png" alt="B Icon" />
                            <h3>{{ catch_ranks_B }}</h3>
                        </li>
                        <li>
                            <img src="/img/ranking-C.png" alt="C Icon" />
                            <h3>{{ catch_ranks_C }}</h3>
                        </li>
                        <li>
                            <img src="/img/ranking-D.png" alt="D Icon" />
                            <h3>{{ catch_ranks_D }}</h3>
                        </li>
                    </ul>
                    <h2 style="padding-top: 30px;">Overall stats</h2>
                    <p>Total score: {{ catch_total_score }}</p>
                    <p>Highest combo: {{ catch_highest_combo }}</p>
                    <p>Bananas catched: {{ catch_bananas_catched }}</p>
                    <p>Banana accuracy: {{ catch_banana_acc }}%</p>
                </div>
            </div>
        </div>
    </div>
    <!-- Page footer -->
    <div id="footer-placeholder"></div>

    <script>
        $(function () {
            $("#footer-placeholder").load("/reused/footer.html");
        });
    </script>
    <!--end of Page footer -->
</body>
<script type="application/javascript">
    const userProfile = {
        data() {
            return {
                username: "",
                discriminator: "",
                bio: "",
                banner: "",
                id: "",
                myID: "-1",
                avatar: "https://i.imgur.com/K0eS3Pi.png",
                isOwn: false,
                roles: [],
                editref: "/profile/edit",
                //
                // svt!catch stats
                //
                catch_scores: "",
                catch_ranks_SS: 0,
                catch_ranks_S: 0,
                catch_ranks_A: 0,
                catch_ranks_B: 0,
                catch_ranks_C: 0,
                catch_ranks_D: 0,
                catch_banana_acc: 100,
                catch_bananas_catched: 0,
                catch_total_score: 0,
                catch_highest_combo: 0,
                //
                // SajberRoyale stats
                //
                royale_games: 0,
                royale_wins: 0,
                royale_winrate: 0,
                royale_kills: 0,
                royale_deaths: 0,
                royale_kd: 0,
                royale_damageDone: "0",
                royale_damageTaken: "0",
                royale_health: 0,
                royale_shotsFired: 0,
                royale_shotsHit: 0,
                royale_acc: 0,
                royale_emotes: 0,
                royale_items: 0,
                royale_lockers: 0
            }

        },
        mounted: function fillProfile() { //Gets user ID from url field and fills profile if it exists.
            this.$nextTick(function () {
                this.vue_getuser();
            })
        },
        methods: {
            async vue_getuser() {
                await axios.post("/auth/getuser", {
                    id: new URL(window.location.href).searchParams.get("user")
                }).then(res => {
                    console.log(res.data);
                    if (res.data != false) { //queried profile existed
                        setUser(this, res.data[0])
                        setCatch(this, res.data[0].catchScores);
                        setRoyale(this, res.data[0].royaleScores);



                    } else { //profile doesn't exist
                        this.username = "Invalid User";
                        this.discriminator = "0000";
                        this.bio = "you messed up!";
                    }

                })
            }
        }
    }

    Vue.createApp(userProfile).mount('#page')

    function setUser(vue, data) {
        document.title = `SVT | ${data.name}'s profile`
        vue.id = data.id;
        vue.username = data.name;
        vue.discriminator = data.discriminator;
        vue.bio = data.bio;
        vue.editref = `/profile/edit?id=${vue.id}`;
        vue.avatar = data.avatar + "?size=256"
        document.getElementById('banner').style.background = `linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('${data.banner}')`;
        document.getElementById('banner').style.backgroundSize = `cover`;
        document.getElementById('banner').style.backgroundRepeat = `no-repeat`;
        document.getElementById('banner').style.backgroundPosition = `center center`;

        if (getCookie("auth").length > 0) vue.myID = JSON.parse(getCookie("auth")).id;

        //set roles
        vue.roles = JSON.parse(data.roles);
        $.each(vue.roles, function (i, role) {
            $("#badges").append(`<p class="badge" style="color: ${data.perms[role].color};">${data.perms[role].title}</p>`);
        })
    }

    function setRoyale(vue, data) {
        var scores = JSON.parse(data);
        vue.royale_games = scores.gamesPlayed;
        vue.royale_wins = scores.gamesWon;

        if (scores.gamesWon == 0) vue.royale_winrate = 0;
        else vue.royale_winrate = (scores.gamesWon / scores.gamesPlayed * 100).toFixed(2);

        vue.royale_deaths = scores.deaths;
        vue.royale_kills = scores.kills;

        if (scores.deaths == 0) vue.royale_kd = scores.kills;
        else vue.royale_kd = (scores.kills / scores.deaths).toFixed(2);

        vue.royale_damageDone = scores.damageDone + (scores.damageDone > scores.damageTaken ? ` (+${(scores.damageDone/scores.damageTaken*100).toFixed()}%)` : "");
        vue.royale_damageTaken = scores.damageTaken + (scores.damageDone < scores.damageTaken ? ` (+${(scores.damageTaken/scores.damageDone*100).toFixed()}%)` : "");;

        vue.royale_health = scores.healthRegenerated;
        vue.royale_shotsFired = scores.shotsFired;
        vue.royale_shotsHit = scores.shotsHit;

        if (scores.shotsHit == 0) vue.royale_acc = 0;
        else vue.royale_acc = (scores.shotsHit / scores.shotsFired * 100).toFixed(2);

        vue.royale_emotes = scores.emotesEmoted;
        vue.royale_items = scores.itemsPickedup;
        vue.royale_lockers = scores.lockersOpened;
    }

    function setCatch(vue, data) {
        var scores = JSON.parse(data);
        vue.catch_ranks_SS = scores.ss;
        vue.catch_ranks_S = scores.s;
        vue.catch_ranks_A = scores.a;
        vue.catch_ranks_B = scores.b;
        vue.catch_ranks_C = scores.c;
        vue.catch_ranks_D = scores.d;
        vue.catch_total_score = cleanNumber(Math.floor(scores.score));
        vue.catch_highest_combo = cleanNumber(scores.highestCombo);
        vue.catch_bananas_catched = cleanNumber(scores.bananasCatched);
        if (scores.bananasSeen == 0) vue.catch_banana_acc = 100;
        else vue.catch_banana_acc = (scores.bananasCatched / scores.bananasSeen * 100).toFixed(2);
    }
</script>

</html>