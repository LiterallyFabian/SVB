<html>

<head>
    <!--Scripts-->
    <script src="https://kit.fontawesome.com/2db49cb13f.js" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/vue@next"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/2db49cb13f.js" crossorigin="anonymous"></script>
    <script src="/js/svt.js"></script>
    <!--Styling-->
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    <link rel="stylesheet" type="text/css" href="/css/profile.css">
    <!--Meta-->
    <title>SVT</title>
</head>

<body id="body">

    <div id="navbar"></div>
    <script src="/js/navigationbar.js"></script>
    <div id="page">
        <div id="banner" class="hero-image">
            <div class="hero-text">
                <img class="avatar" :src="avatar" alt="profile picture"></img>
                <h1>{{ username }}#{{ discriminator }}</h1>
                <div v-if="id == myID">
                    <a href="/profile/edit"><i class="editprofile far fa-edit fa-sm">
                        </i></a></div>
                <p>{{ bio }}</p>
            </div>
        </div>
        <div id="gallery" class="center">
            <div class="center catch-stats">
                <ul id="rank-list">
                    <h1 style="padding:20px;">svt!catch stats</h1>
                    <h2>Ranks achieved</h2>
                    <li>
                        <img src="/img/ranking-SS.png" alt="SS Icon" />
                        <h3>{{ ranks_SS }}</h3>
                    </li>
                    <li>
                        <img src="/img/ranking-S.png" alt="S Icon" />
                        <h3>{{ ranks_S }}</h3>
                    </li>
                    <li>
                        <img src="/img/ranking-A.png" alt="A Icon" />
                        <h3>{{ ranks_A }}</h3>
                    </li>
                    <li>
                        <img src="/img/ranking-B.png" alt="B Icon" />
                        <h3>{{ ranks_B }}</h3>
                    </li>
                    <li>
                        <img src="/img/ranking-C.png" alt="C Icon" />
                        <h3>{{ ranks_C }}</h3>
                    </li>
                    <li>
                        <img src="/img/ranking-D.png" alt="D Icon" />
                        <h3>{{ ranks_D }}</h3>
                    </li>
                </ul>
                <h2 style="padding-top: 30px;">Overall stats</h2>
                <p>Total score: {{ total_score }}</p>
                <p>Highest combo: {{ highest_combo }}</p>
                <p>Bananas catched: {{ bananas_catched }}</p>
                <p>Banana accuracy: {{ banana_acc }}%</p>

            </div>
        </div>
    </div>

</body>
<script type="application/javascript">
    const postCreation = {
        data() {
            return {
                username: "Invalid User",
                discriminator: "0000",
                bio: "you messed up!",
                banner: "",
                id: "",
                myID: "-1",
                avatar: "https://i.imgur.com/K0eS3Pi.png",
                isOwn: false,
                catchScores: "",
                ranks_SS: 0,
                ranks_S: 0,
                ranks_A: 0,
                ranks_B: 0,
                ranks_C: 0,
                ranks_D: 0,
                banana_acc: 100,
                bananas_catched: 0,
                total_score: 0,
                highest_combo: 0
            }

        },
        mounted: function fillProfile() { //Gets user ID from url field and fills profile if it exists.
            this.$nextTick(function () {
                var url = new URL(window.location.href);
                var id = url.searchParams.get("user");
                if (id != null) {
                    this.id = id;
                    this.vue_getuser();
                }

            })
        },
        methods: {
            async vue_getuser() {
                await axios.post("/auth/getuser", {
                    id: this.id
                }).then(res => {
                    if (res.data[0].name != null) {
                        document.title = `SVT | ${res.data[0].name}'s profile`
                        this.username = res.data[0].name;
                        this.discriminator = res.data[0].discriminator;
                        this.bio = res.data[0].bio;
                        this.catchScores = JSON.parse(res.data[0].catchScores);
                        this.ranks_SS = this.catchScores.ss;
                        this.ranks_S = this.catchScores.s;
                        this.ranks_A = this.catchScores.a;
                        this.ranks_B = this.catchScores.b;
                        this.ranks_C = this.catchScores.c;
                        this.ranks_D = this.catchScores.d;
                        this.total_score = cleanNumber(Math.floor(this.catchScores.score));
                        this.highest_combo = cleanNumber(this.catchScores.highestCombo);
                        this.bananas_catched = cleanNumber(this.catchScores.bananasCatched);
                        if (this.catchScores.bananasSeen == 0) banana_acc = 100;
                        else this.banana_acc = (this.catchScores.bananasCatched / this.catchScores.bananasSeen * 100).toFixed(2);

                    };
                    document.getElementById('banner').style.background = `linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('${res.data[0].banner}')`;
                    document.getElementById('banner').style.backgroundSize = `cover`;
                    document.getElementById('banner').style.backgroundRepeat = `no-repeat`;
                    document.getElementById('banner').style.backgroundPosition = `center center`;
                    this.avatar = res.data[0].avatar + "?size=256"
                    if (getCookie("auth").length > 0) this.myID = JSON.parse(getCookie("auth")).id;
                })
            }
        }
    }

    Vue.createApp(postCreation).mount('#page')
</script>

</html>