<html class="theme_light">

<head>
    <!--Scripts-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://kit.fontawesome.com/2db49cb13f.js" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/vue@3.0.5"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/2db49cb13f.js" crossorigin="anonymous"></script>
    <script src="/js/svt.js"></script>
    <!--Styling-->
    <link href="/stylesheets/main.css" rel="stylesheet" type="text/css">
    <!--Meta-->
    <title>SVT</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body id="profilebody">

    <!--Navigation bar-->
    <div id="nav-placeholder"></div>

    <script>
        $(function () {
            $("#nav-placeholder").load("/reused/nav.html");
        });
    </script>
    <!--end of Navigation bar-->

    <div id="page">
        <div id="banner" class="hero-image">
            <div class="banneritems">
                <div class="hero-text">
                    <img class="avatar" :src="avatar" alt="profile picture"></img>
                    <h1>{{ username }}</h1>
                    <div id="badges">

                    </div>
                    <div v-if="id == myID">
                        <a v-bind:href="editref"><i class="editprofile far fa-edit fa-sm">
                            </i></a></div>
                    <p>{{ bio }}</p>
                </div>
            </div>
        </div>
        <div id="gallery" class="center">
            <div class="center catch-stats">
                <ul id="rank-list">
                    <h1 style="padding:20px;">svt!catch stats</h1>
                    <h2>Ranks achieved</h2>
                    <li>
                        <img src="/img/ranking-SS.png" alt="SS Icon" />
                        <h3>{{ ranks_SS }}</h3>
                    </li>
                    <li>
                        <img src="/img/ranking-S.png" alt="S Icon" />
                        <h3>{{ ranks_S }}</h3>
                    </li>
                    <li>
                        <img src="/img/ranking-A.png" alt="A Icon" />
                        <h3>{{ ranks_A }}</h3>
                    </li>
                    <li>
                        <img src="/img/ranking-B.png" alt="B Icon" />
                        <h3>{{ ranks_B }}</h3>
                    </li>
                    <li>
                        <img src="/img/ranking-C.png" alt="C Icon" />
                        <h3>{{ ranks_C }}</h3>
                    </li>
                    <li>
                        <img src="/img/ranking-D.png" alt="D Icon" />
                        <h3>{{ ranks_D }}</h3>
                    </li>
                </ul>
                <h2 style="padding-top: 30px;">Overall stats</h2>
                <p>Total score: {{ total_score }}</p>
                <p>Highest combo: {{ highest_combo }}</p>
                <p>Bananas catched: {{ bananas_catched }}</p>
                <p>Banana accuracy: {{ banana_acc }}%</p>

            </div>
        </div>
    </div>
</body>
<script type="application/javascript">
    const userProfile = {
        data() {
            return {
                username: "",
                discriminator: "",
                bio: "",
                banner: "",
                id: "",
                myID: "-1",
                avatar: "https://i.imgur.com/K0eS3Pi.png",
                isOwn: false,
                catchScores: "",
                ranks_SS: 0,
                ranks_S: 0,
                ranks_A: 0,
                ranks_B: 0,
                ranks_C: 0,
                ranks_D: 0,
                banana_acc: 100,
                bananas_catched: 0,
                total_score: 0,
                highest_combo: 0,
                roles: [],
                editref: "/profile/edit"
            }

        },
        mounted: function fillProfile() { //Gets user ID from url field and fills profile if it exists.
            this.$nextTick(function () {
                this.vue_getuser();
            })
        },
        methods: {
            async vue_getuser() {
                await axios.post("/auth/getuser", {
                    id: new URL(window.location.href).searchParams.get("user")
                }).then(res => {
                    if (res.data != false) { //queried profile existed
                        document.title = `SVT | ${res.data[0].name}'s profile`
                        this.id = res.data[0].id;
                        this.username = res.data[0].name;
                        this.discriminator = res.data[0].discriminator;
                        this.bio = res.data[0].bio;
                        this.editref = `/profile/edit?id=${this.id}`;
                        this.catchScores = JSON.parse(res.data[0].catchScores);
                        this.ranks_SS = this.catchScores.ss;
                        this.ranks_S = this.catchScores.s;
                        this.ranks_A = this.catchScores.a;
                        this.ranks_B = this.catchScores.b;
                        this.ranks_C = this.catchScores.c;
                        this.ranks_D = this.catchScores.d;
                        this.total_score = cleanNumber(Math.floor(this.catchScores.score));
                        this.highest_combo = cleanNumber(this.catchScores.highestCombo);
                        this.bananas_catched = cleanNumber(this.catchScores.bananasCatched);
                        if (this.catchScores.bananasSeen == 0) banana_acc = 100;
                        else this.banana_acc = (this.catchScores.bananasCatched / this.catchScores.bananasSeen * 100).toFixed(2);
                        document.getElementById('banner').style.background = `linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('${res.data[0].banner}')`;
                        document.getElementById('banner').style.backgroundSize = `cover`;
                        document.getElementById('banner').style.backgroundRepeat = `no-repeat`;
                        document.getElementById('banner').style.backgroundPosition = `center center`;
                        this.avatar = res.data[0].avatar + "?size=256"
                        if (getCookie("auth").length > 0) this.myID = JSON.parse(getCookie("auth")).id;

                        //set roles
                        this.roles = JSON.parse(res.data[0].roles);
                        $.each(this.roles, function (i, role) {
                            $("#badges").append(`<p class="badge" style="color: ${res.data[0].perms[role].color};">${res.data[0].perms[role].title}</p>`);
                        })

                    } else { //profile doesn't exist
                        this.username = "Invalid User";
                        this.discriminator = "0000";
                        this.bio = "you messed up!";
                    }

                })
            }
        }
    }

    Vue.createApp(userProfile).mount('#page')
</script>

</html>